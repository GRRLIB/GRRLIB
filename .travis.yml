language: c
sudo: required

os:
  - linux

env:
  global:
    - DEVKITPRO=/opt/devkitpro
    - DEVKITPPC=${DEVKITPRO}/devkitPPC

addons:
  apt:
    packages:
      - doxygen
      - doxygen-latex

cache:
  directories:
    - ${DEVKITPRO}

before_install:
  - wget https://github.com/devkitPro/pacman/releases/download/devkitpro-pacman-1.0.1/devkitpro-pacman.deb

install:
  - sudo dpkg --install devkitpro-pacman.deb
  - sudo dkp-pacman --sync --sysupgrade --refresh --needed --noconfirm wii-dev ppc-libpng ppc-freetype ppc-libjpeg-turbo

script:
  - (cd GRRLIB && sudo -E make clean all install)
  - (cd examples && make)
  - (cd GRRLIB && sudo -E make PLATFORM=cube clean all)
  - doxygen grrlib.doxygen >/dev/null
  - make --directory=latex >/dev/null

before_deploy:
  - touch doc/.nojekyll
  - mv latex/refman.pdf doc/PDF-documentation.pdf

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: doc
  github_token: $GITHUB_TOKEN
  on:
    branch: master
